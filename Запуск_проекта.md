# Инструкция по запуску docker-compose

**1. Клонируйте репозиторий и перейдите в папку с проектом:**

~~~   
git clone https://github.com/rom234240/diplom-netology
cd diplom-netology\
~~~

**2. Настройте переменные окружения и сгенерируйте SECRET_KEY для переменной:**

~~~ 
# Отредактируйте .env файл
nano .env # или используйте любой текстовый редактор

# Сгенерируйте новый секретный ключ для переменной SECRET_KEY
python -c "import secrets; print(secrets.token_urlsafe(50))"

~~~

**3. Запустите проект:**

~~~
# Сборка и запуск контейнеров
docker-compose up --build -d
~~~

**4. Проверьте работу и посмотрите логи:**

~~~
# Проверьте статус контейнеров
docker-compose ps

# Просмотрите логи
docker-compose logs -f
~~~

**5. Создайте суперпользователя после запуска:**

~~~
docker-compose exec web python manage.py createsuperuser
~~~
**6. Проверка работы:**

- Django приложение: http://localhost:8000
- Swagger документация: http://localhost:8000/swagger
- Админ-панель: http://localhost:8000/admin
- Мониторинг задач (Flower): http://localhost:5555

## Полезные команды управления:


#### Остановить все контейнеры:
~~~
docker-compose down
~~~
#### Остановить с удалением volumes:
~~~
docker-compose down -v
~~~
#### Пересобрать конкретный сервис:
~~~
docker-compose up -d --build web
~~~
#### Выполнить команду в контейнере:
~~~
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py collectstatic
~~~
#### Просмотр логов конкретного сервиса:
~~~
docker-compose logs -f web
docker-compose logs -f db
~~~
#### Проверяем итоговое покрытие coverage:
~~~
docker-compose run --rm tests bash -c "
cd orders && 
echo '=== Итоговое покрытие ===' && 
coverage run -m pytest backend/tests/ -q && 
coverage report --include='backend/views.py'
"
~~~
#### Запускаем тестирование троттлинга:
~~~
docker-compose run --rm tests bash -c "
cd orders && 
echo '=== Тестирование троттлинга ===' && 
pytest backend/tests/test_throttling.py -v
"
~~~
#### Проверяем настройки троттлинга:
~~~
docker-compose run --rm tests bash -c "
cd orders && 
python -c \"
import os
import sys
import django

# Устанавливаем переменные окружения Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'orders.settings')

# Настраиваем Django
django.setup()

from django.conf import settings
print('=== Финальная проверка настроек ===')
rf_settings = settings.REST_FRAMEWORK

print('1. DEFAULT_THROTTLE_CLASSES:')
for cls in rf_settings.get('DEFAULT_THROTTLE_CLASSES', []):
    print('   -', cls)

print('\\\\n2. DEFAULT_THROTTLE_RATES:')
for key, value in rf_settings.get('DEFAULT_THROTTLE_RATES', {}).items():
    print('   - {}: {}'.format(key, value))

print('\\\\n3. Проверка views:')
try:
    from backend.views import RegisterView, LoginView, PartnerUpdate
    print('   - RegisterView.throttle_scope: {}'.format(getattr(RegisterView, 'throttle_scope', 'Не установлен')))
    print('   - LoginView.throttle_scope: {}'.format(getattr(LoginView, 'throttle_scope', 'Не установлен')))
    print('   - PartnerUpdate.throttle_scope: {}'.format(getattr(PartnerUpdate, 'throttle_scope', 'Не установлен')))
except ImportError as e:
    print('   Ошибка импорта views:', e)

print('\\\\n✓ Проверка завершена!')
\"
"
~~~
#### Запуск теста производительности:
~~~
docker-compose exec web python manage.py test_cache_performance --iterations=5
~~~